<!DOCTYPE html>
<html lang="vn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý Danh mục - Spark Flower</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div
      class="seller-header d-flex align-items-center justify-content-between px-4 py-3 shadow-sm"
    >
      <div class="d-flex align-items-center">
        <img src="asset/hinhanh/logo2 (2).png" width="120" class="me-3" />
      </div>

      <h3 class="fw-bold m-0" style="color: #a1152c">SPARK SELLER</h3>

      <div style="width: 120px"></div>
    </div>

    <div class="sidebar">
      <ul class="nav flex-column mt-4">
        <li class="nav-item">
          <a
            href="seller.html"
            class="nav-link active fs-4 fw-bold"
            style="color: #d3213f"
          >
            <i class="fas fa-chart-line me-2 fs-3"></i> Tổng quan
          </a>
        </li>
        <li class="nav-item">
          <a href="seller_category.html" class="nav-link fs-4 fw-bold" style="color: #d3213f">
          <i class="fas fa-tags me-2"></i> Danh mục
          </a>
        </li>
        <li class="nav-item">
          <a
            href="seller_product.html"
            class="nav-link fs-4 fw-bold"
            style="color: #d3213f"
          >
            <i class="fas fa-box-open me-2"></i> Sản phẩm
          </a>
        </li>
        <li class="nav-item">
          <a
            href="seller_orders.html"
            class="nav-link fs-4 fw-bold"
            style="color: #d3213f"
          >
            <i class="fas fa-shopping-cart me-2"></i> Đơn hàng
          </a>
        </li>
        <li class="nav-item">
          <a
            href="index.html"
            class="nav-link fs-4 fw-bold"
            style="color: #d3213f"
          >
            <i class="fas fa-sign-out-alt me-2"></i> Về trang chủ
          </a>
        </li>
      </ul>
    </div>

    <div class="main-content">
      <h2
        class="mb-4 fw-bold text-center text-uppercase"
        style="color: #31020a"
      >
        Quản lý Danh mục sản phẩm
      </h2>
      <div class="row">
            <div class="col-md-5">
                <div class="card border-0 shadow-sm p-4 h-100" style="border-radius: 15px;">
                    <h5 class="fw-bold mb-3"><i class="fas fa-plus-circle me-2"></i>Thêm danh mục mới</h5>
                    <form id="addCategoryForm">
                        <div class="mb-3">
                            <label class="form-label text-muted fw-bold">Tên danh mục</label>
                            <input type="text" class="form-control" id="catName" placeholder="VD: Hoa lan hồ điệp..." required>
                        </div>
                        <button type="submit" class="btn btn-danger w-100 py-2 fw-bold">
                            <i class="fas fa-save me-2"></i>Lưu danh mục
                        </button>
                    </form>
                </div>
            </div>

            <div class="col-md-7">
                <div class="card border-0 shadow-sm p-4 h-100" style="border-radius: 15px;">
                    <h5 class="fw-bold mb-3"><i class="fas fa-list me-2"></i>Danh sách hiện có</h5>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Tên danh mục</th>
                                    <th class="text-end">Hành động</th>
                                </tr>
                            </thead>
                            <tbody id="categoryTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    <script>
        // 1. Danh sách các file chứa danh mục
        const categoryApis = [
            "data/chude1.json",
            "data/hoatuoi1.json",
            "data/kieudang1.json"
        ];

        // Bảng dịch từ Mã danh mục (trong JSON) sang Tên hiển thị (Tiếng Việt)
        const categoryNames = {
            "hoasinhnhat": "Hoa sinh nhật",
            "hoacauhon": "Hoa cầu hôn",
            "hoakhaitruong": "Hoa khai trương",
            "hoatotnghiep": "Hoa tốt nghiệp",
            "hoahong": "Hoa hồng",
            "hoahuongduong": "Hoa hướng dương",
            "hoababy": "Hoa baby",
            "bohoa": "Bó hoa",
            "giohoa": "Giỏ hoa"
        };

        // 2. Khởi tạo dữ liệu
        function initCategories() {
            // Nếu đã có dữ liệu trong LocalStorage thì dùng luôn, không tải lại
            if (localStorage.getItem("categories")) {
                renderCategories();
                return;
            }

            // Nếu chưa có, tải từ các file JSON
            Promise.all(categoryApis.map(url => fetch(url).then(res => res.json())))
            .then(results => {
                let catSet = new Set(); // Dùng Set để tránh trùng lặp

                results.forEach(data => {
                    if (data.categories) {
                        // Lấy các key: hoasinhnhat, hoahong...
                        Object.keys(data.categories).forEach(key => {
                            // Dịch sang tiếng Việt (nếu có trong bảng dịch), nếu không thì giữ nguyên
                            const name = categoryNames[key] || key;
                            catSet.add(name);
                        });
                    }
                });

                // Thêm vài danh mục mặc định nếu trong file JSON chưa có
                catSet.add("Hoa chia buồn");
                catSet.add("Lan hồ điệp");

                // Lưu vào LocalStorage
                const finalList = Array.from(catSet);
                localStorage.setItem("categories", JSON.stringify(finalList));
                
                renderCategories();
            })
            .catch(err => {
                console.error("Lỗi tải danh mục:", err);
                // Fallback nếu lỗi mạng: Dùng danh mục cứng
                const defaultCats = ["Hoa sinh nhật", "Hoa khai trương", "Bó hoa", "Giỏ hoa"];
                localStorage.setItem("categories", JSON.stringify(defaultCats));
                renderCategories();
            });
        }

        // 3. Hiển thị bảng
        function renderCategories() {
            const list = JSON.parse(localStorage.getItem("categories")) || [];
            const tbody = document.getElementById("categoryTableBody");
            
            if(list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="text-center">Chưa có danh mục nào</td></tr>';
                return;
            }

            tbody.innerHTML = list.map((cat, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td class="fw-bold text-dark">${cat}</td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${index})">
                            <i class="fas fa-trash"></i> Xóa
                        </button>
                    </td>
                </tr>
            `).join("");
        }

        // 4. Thêm danh mục
        document.getElementById("addCategoryForm").addEventListener("submit", (e) => {
            e.preventDefault();
            const name = document.getElementById("catName").value.trim();
            if(!name) return;

            const list = JSON.parse(localStorage.getItem("categories")) || [];
            
            // Kiểm tra trùng lặp (không phân biệt hoa thường)
            const exists = list.some(cat => cat.toLowerCase() === name.toLowerCase());
            if(exists) {
                alert("Danh mục này đã tồn tại!");
                return;
            }

            list.push(name);
            localStorage.setItem("categories", JSON.stringify(list));
            
            alert("Đã thêm thành công!");
            document.getElementById("catName").value = "";
            renderCategories();
        });

        // 5. Xóa danh mục
        function deleteCategory(index) {
            if(confirm("Bạn có chắc chắn muốn xóa danh mục này?")) {
                const list = JSON.parse(localStorage.getItem("categories")) || [];
                list.splice(index, 1);
                localStorage.setItem("categories", JSON.stringify(list));
                renderCategories();
            }
        }

        // Chạy khi mở trang
        document.addEventListener("DOMContentLoaded", initCategories);
    </script>
  </body>
</html>
